<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Color Card Gen (Transparent PNG)</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
    body { font-family: sans-serif; padding: 15px; background: #f4f7f9; margin: 0; padding-bottom: 100px; }
    .controls { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
    .control-row { background: #fff; border-radius: 10px; padding: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: grid; grid-template-columns: 1fr 90px 45px; gap: 8px; align-items: center; }
    .control-row h3 { grid-column: 1 / -1; margin: 0 0 5px 0; font-size: 12px; color: #888; }
    input[type="text"] { width: 100%; padding: 8px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
    .hex-input { font-family: monospace; text-transform: uppercase; }
    input[type="color"] { width: 100%; height: 38px; border: 1px solid #ddd; border-radius: 4px; background: none; padding: 0; cursor: pointer; }
    
    .btn-area { position: sticky; top: 0; background: #f4f7f9; padding: 10px 0; z-index: 10; }
    .download-btn { width: 100%; padding: 15px; font-size: 17px; font-weight: bold; color: white; background: #007AFF; border: none; border-radius: 8px; cursor: pointer; }

    /* 画像になるエリア：背景を完全に透明に設定 */
    #capture-area { background: transparent; padding: 10px; display: inline-block; }
    .card { width: 450px; height: 160px; padding: 25px; border-radius: 25px; margin-bottom: 20px; position: relative; box-sizing: border-box; text-align: left; border: 1px solid rgba(0,0,0,0.05); }
    .label { position: absolute; bottom: 20px; left: 25px; font-weight: bold; font-size: 26px; line-height: 1.2em; }
    .code { font-size: 20px; opacity: 0.8; font-weight: normal; }

    /* 保存用出力エリア：透明であることを確認しやすくするためにチェック柄の背景を敷いています */
    #result-output { margin-top: 20px; text-align: center; border-top: 2px dashed #ccc; padding-top: 20px; display: none; }
    #result-output img { 
        max-width: 100%; 
        border: 2px solid #007AFF; 
        border-radius: 8px;
        /* 透明確認用の市松模様（画像自体には入りません） */
        background-image: linear-gradient(45deg, #eee 25%, transparent 25%, transparent 75%, #eee 75%), 
                          linear-gradient(45deg, #eee 25%, white 25%, white 75%, #eee 75%);
        background-size: 20px 20px;
        background-position: 0 0, 10px 10px;
    }
    .guide-msg { color: #007AFF; font-weight: bold; margin-bottom: 10px; }
</style>
</head>
<body>

<div class="btn-area">
    <button class="download-btn" onclick="generateImage()">透明な画像を作成する</button>
</div>

<div class="controls">
    <div class="control-row">
        <h3>CARD 1</h3>
        <input id="label1" type="text" placeholder="名前" onfocus="this.dataset.manual='true'">
        <input id="hex1" class="hex-input" type="text" placeholder="B9ECFF" maxlength="6" inputmode="email">
        <input id="color1" type="color" value="#ffffff">
    </div>
    <div class="control-row">
        <h3>CARD 2</h3>
        <input id="label2" type="text" placeholder="名前" onfocus="this.dataset.manual='true'">
        <input id="hex2" class="hex-input" type="text" placeholder="A8D8FF" maxlength="6" inputmode="email">
        <input id="color2" type="color" value="#ffffff">
    </div>
    <div class="control-row">
        <h3>CARD 3</h3>
        <input id="label3" type="text" placeholder="名前" onfocus="this.dataset.manual='true'">
        <input id="hex3" class="hex-input" type="text" placeholder="FFD0EC" maxlength="6" inputmode="email">
        <input id="color3" type="color" value="#ffffff">
    </div>
    <div class="control-row">
        <h3>CARD 4</h3>
        <input id="label4" type="text" placeholder="名前" onfocus="this.dataset.manual='true'">
        <input id="hex4" class="hex-input" type="text" placeholder="FFFFFF" maxlength="6" inputmode="email">
        <input id="color4" type="color" value="#ffffff">
    </div>
</div>

<div id="capture-area">
    <div id="card1" class="card"><div class="label"><span id="ln1"></span><br><span id="lc1" class="code"></span></div></div>
    <div id="card2" class="card"><div class="label"><span id="ln2"></span><br><span id="lc2" class="code"></span></div></div>
    <div id="card3" class="card"><div class="label"><span id="ln3"></span><br><span id="lc3" class="code"></span></div></div>
    <div id="card4" class="card"><div class="label"><span id="ln4"></span><br><span id="lc4" class="code"></span></div></div>
</div>

<div id="result-output">
    <p class="guide-msg">↓ 下の画像を長押しして保存してください ↓<br>(背景は透明になります)</p>
    <div id="img-container"></div>
</div>

<script>
// 色名判定ロジック
const COLOR_NAMES = [
    { name: "White", rgb: [255,255,255] }, { name: "Silver", rgb: [192,192,192] },
    { name: "Sky Blue", rgb: [135,206,235] }, { name: "Mint Green", rgb: [189,252,201] },
    { name: "Pink", rgb: [255,192,203] }, { name: "Red", rgb: [255,0,0] },
    { name: "Navy", rgb: [0,0,128] }, { name: "Black", rgb: [0,0,0] }
];

function hexToRgb(hex) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return [r, g, b];
}

function getClosestColorName(hex) {
    const [r, g, b] = hexToRgb(hex);
    let closest = "Color";
    let minDist = Infinity;
    COLOR_NAMES.forEach(c => {
        const d = Math.pow(r-c.rgb[0],2) + Math.pow(g-c.rgb[1],2) + Math.pow(b-c.rgb[2],2);
        if(d < minDist) { minDist = d; closest = c.name; }
    });
    return closest;
}

function sync(i, source) {
    const hexInp = document.getElementById(`hex${i}`);
    const colorInp = document.getElementById(`color${i}`);
    const labelInp = document.getElementById(`label${i}`);
    const card = document.getElementById(`card${i}`);
    const ln = document.getElementById(`ln${i}`);
    const lc = document.getElementById(`lc${i}`);

    let val = (source === 'picker' ? colorInp.value : hexInp.value).trim();
    if (source === 'hex' && val.length === 6 && !val.startsWith('#')) val = '#' + val;
    
    if (/^#[0-9A-Fa-f]{6}$/.test(val)) {
        if (source === 'picker') hexInp.value = val.replace('#','').toUpperCase();
        if (source === 'hex') colorInp.value = val;
        if (labelInp.dataset.manual !== "true") labelInp.value = getClosestColorName(val).toUpperCase();

        card.style.background = val;
        card.style.border = "none";
        lc.textContent = val.toUpperCase();
        const [r,g,b] = hexToRgb(val);
        const bright = (r*299 + g*587 + b*114) / 1000;
        card.style.color = bright > 180 ? "#555" : "#fff";
    } else if (val === "") {
        card.style.background = "transparent";
        card.style.border = "1px solid #eee";
        lc.textContent = "";
    }
    ln.textContent = labelInp.value;
}

for (let i = 1; i <= 4; i++) {
    document.getElementById(`hex${i}`).addEventListener("input", () => sync(i, 'hex'));
    document.getElementById(`color${i}`).addEventListener("input", () => sync(i, 'picker'));
    document.getElementById(`label${i}`).addEventListener("input", (e) => {
        e.target.dataset.manual = "true";
        sync(i, 'hex');
    });
    document.getElementById(`label${i}`).addEventListener("click", (e) => e.target.dataset.manual = "true");
}

function generateImage() {
    const area = document.getElementById("capture-area");
    const output = document.getElementById("result-output");
    const container = document.getElementById("img-container");
    
    // 背景を透明(null)にしてキャプチャ
    html2canvas(area, { 
        scale: 2, 
        backgroundColor: null,
        logging: false
    }).then(canvas => {
        const img = new Image();
        img.src = canvas.toDataURL("image/png");
        container.innerHTML = "";
        container.appendChild(img);
        output.style.display = "block";
        output.scrollIntoView({ behavior: 'smooth' });
    });
}
</script>
</body>
</html>
