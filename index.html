<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Color Card Gen Pro</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
    body { font-family: sans-serif; padding: 15px; background: #f4f7f9; margin: 0; padding-bottom: 100px; }
    .controls { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
    .control-row { background: #fff; border-radius: 10px; padding: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: grid; grid-template-columns: 1fr 90px 45px; gap: 8px; align-items: center; }
    .control-row h3 { grid-column: 1 / -1; margin: 0 0 5px 0; font-size: 12px; color: #888; }
    input[type="text"] { width: 100%; padding: 8px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
    .hex-input { font-family: monospace; text-transform: uppercase; }
    input[type="color"] { width: 100%; height: 38px; border: 1px solid #ddd; border-radius: 4px; background: none; padding: 0; cursor: pointer; }
    
    .btn-area { position: sticky; top: 0; background: #f4f7f9; padding: 10px 0; z-index: 10; }
    .download-btn { width: 100%; padding: 15px; font-size: 17px; font-weight: bold; color: white; background: #007AFF; border: none; border-radius: 8px; cursor: pointer; }

    #capture-area { background: transparent; padding: 10px; display: inline-block; }
    .card { width: 450px; height: 160px; padding: 25px; border-radius: 25px; margin-bottom: 20px; position: relative; box-sizing: border-box; text-align: left; border: 1px solid rgba(0,0,0,0.05); }
    .label { position: absolute; bottom: 20px; left: 25px; font-weight: bold; font-size: 26px; line-height: 1.2em; }
    .code { font-size: 20px; opacity: 0.8; font-weight: normal; }

    #result-output { margin-top: 20px; text-align: center; border-top: 2px dashed #ccc; padding-top: 20px; display: none; }
    #result-output img { 
        max-width: 100%; border: 2px solid #007AFF; border-radius: 8px;
        background-image: linear-gradient(45deg, #eee 25%, transparent 25%, transparent 75%, #eee 75%), 
                          linear-gradient(45deg, #eee 25%, white 25%, white 75%, #eee 75%);
        background-size: 20px 20px; background-position: 0 0, 10px 10px;
    }
</style>
</head>
<body>

<div class="btn-area">
    <button class="download-btn" onclick="generateImage()">透明な画像を作成する</button>
</div>

<div class="controls" id="ui-root"></div>

<div id="capture-area"></div>

<div id="result-output">
    <p style="color:#007AFF; font-weight:bold;">↓ 下の画像を長押しして保存 ↓</p>
    <div id="img-container"></div>
</div>

<script>
// 拡張されたカラーリスト
const COLOR_NAMES = [
    // モノトーン
    {name:"WHITE",rgb:[255,255,255]},{name:"SNOW",rgb:[255,250,250]},{name:"IVORY",rgb:[255,255,240]},{name:"SILVER",rgb:[192,192,192]},{name:"GRAY",rgb:[128,128,128]},{name:"CHARCOAL",rgb:[54,69,79]},{name:"BLACK",rgb:[0,0,0]},
    // ブルー・水色
    {name:"SKY BLUE",rgb:[135,206,235]},{name:"LIGHT BLUE",rgb:[173,216,230]},{name:"AQUA",rgb:[0,255,255]},{name:"TURQUOISE",rgb:[64,224,208]},{name:"CYAN",rgb:[0,255,255]},{name:"BABY BLUE",rgb:[137,207,240]},{name:"STEEL BLUE",rgb:[70,130,180]},{name:"ROYAL BLUE",rgb:[65,105,225]},{name:"NAVY",rgb:[0,0,128]},{name:"ICE BLUE",rgb:[240,248,255]},
    // グリーン
    {name:"MINT",rgb:[189,252,201]},{name:"SEA FOAM",rgb:[154,255,154]},{name:"PALE GREEN",rgb:[152,251,152]},{name:"LIME",rgb:[0,255,0]},{name:"OLIVE",rgb:[128,128,0]},{name:"FOREST GREEN",rgb:[34,139,34]},{name:"EMERALD",rgb:[80,200,120]},{name:"PISTACHIO",rgb:[147,197,114]},
    // ピンク・赤
    {name:"PINK",rgb:[255,192,203]},{name:"LIGHT PINK",rgb:[255,182,193]},{name:"CHERRY BLOSSOM",rgb:[255,183,197]},{name:"ROSE",rgb:[255,0,127]},{name:"HOT PINK",rgb:[255,105,180]},{name:"CORAL",rgb:[255,127,80]},{name:"SALMON",rgb:[250,128,114]},{name:"RED",rgb:[255,0,0]},{name:"WINE RED",rgb:[153,0,0]},{name:"BURGUNDY",rgb:[128,0,32]},
    // イエロー・オレンジ・ブラウン
    {name:"YELLOW",rgb:[255,255,0]},{name:"LEMON",rgb:[255,250,205]},{name:"CREAM",rgb:[255,253,208]},{name:"BEIGE",rgb:[245,245,220]},{name:"PEACH",rgb:[255,218,185]},{name:"ORANGE",rgb:[255,165,0]},{name:"APRICOT",rgb:[251,206,177]},{name:"BROWN",rgb:[165,42,42]},{name:"CHOCOLATE",rgb:[123,63,0]},{name:"CAMEL",rgb:[193,154,107]},{name:"TERRACOTTA",rgb:[226,114,91]},
    // パープル・バイオレット
    {name:"LAVENDER",rgb:[230,230,250]},{name:"LILAC",rgb:[200,162,200]},{name:"MAUVE",rgb:[224,176,255]},{name:"PURPLE",rgb:[128,0,128]},{name:"VIOLET",rgb:[238,130,238]},{name:"ORCHID",rgb:[218,112,214]}
];

function hexToRgb(hex) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return [r, g, b];
}

function getClosestName(hex) {
    const [r, g, b] = hexToRgb(hex);
    let closest = "CUSTOM COLOR";
    let minDist = Infinity;
    COLOR_NAMES.forEach(c => {
        const d = Math.pow(r-c.rgb[0],2) + Math.pow(g-c.rgb[1],2) + Math.pow(b-c.rgb[2],2);
        if(d < minDist) { minDist = d; closest = c.name; }
    });
    return closest;
}

function sync(i, source) {
    const hexI = document.getElementById(`hex${i}`);
    const colI = document.getElementById(`col${i}`);
    const labI = document.getElementById(`lab${i}`);
    const card = document.getElementById(`card${i}`);
    const ln = document.getElementById(`ln${i}`);
    const lc = document.getElementById(`lc${i}`);

    let val = (source === 'p' ? colI.value : hexI.value).trim();
    if (source === 'h' && val.length === 6 && !val.startsWith('#')) val = '#' + val;
    
    if (/^#[0-9A-Fa-f]{6}$/.test(val)) {
        if (source === 'p') hexI.value = val.replace('#','').toUpperCase();
        if (source === 'h') colI.value = val;
        if (labI.dataset.manual !== "true") labI.value = getClosestName(val);

        card.style.background = val;
        card.style.border = "none";
        lc.textContent = val.toUpperCase();
        const [r,g,b] = hexToRgb(val);
        const bright = (r*299 + g*587 + b*114) / 1000;
        card.style.color = bright > 180 ? "#555" : "#fff";
    }
    ln.textContent = labI.value;
}

// UI生成
const uiRoot = document.getElementById('ui-root');
const capArea = document.getElementById('capture-area');
for (let i = 1; i <= 4; i++) {
    uiRoot.innerHTML += `
        <div class="control-row">
            <h3>CARD ${i}</h3>
            <input id="lab${i}" type="text" placeholder="名前" onfocus="this.dataset.manual='true'">
            <input id="hex${i}" class="hex-input" type="text" placeholder="FFFFFF" maxlength="6" inputmode="email">
            <input id="col${i}" type="color" value="#ffffff">
        </div>`;
    capArea.innerHTML += `
        <div id="card${i}" class="card"><div class="label"><span id="ln${i}"></span><br><span id="lc${i}" class="code"></span></div></div>`;
}

// イベント登録
for (let i = 1; i <= 4; i++) {
    document.getElementById(`hex${i}`).addEventListener("input", () => sync(i, 'h'));
    document.getElementById(`col${i}`).addEventListener("input", () => sync(i, 'p'));
    document.getElementById(`lab${i}`).addEventListener("input", (e) => { e.target.dataset.manual = "true"; sync(i, 'h'); });
}

function generateImage() {
    const output = document.getElementById("result-output");
    const container = document.getElementById("img-container");
    html2canvas(document.getElementById("capture-area"), { scale: 2, backgroundColor: null }).then(canvas => {
        const img = new Image();
        img.src = canvas.toDataURL("image/png");
        container.innerHTML = "";
        container.appendChild(img);
        output.style.display = "block";
        output.scrollIntoView({ behavior: 'smooth' });
    });
}
</script>
</body>
</html>
