<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>4 Color Cards Generator (Sync Mode)</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
    body {
        font-family: sans-serif;
        padding: 20px;
        background-color: #f4f7f9;
        margin: 0;
    }

    .controls {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 20px;
    }

    .control-row {
        background: #fff;
        border-radius: 10px;
        padding: 12px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        display: grid;
        grid-template-columns: 1fr 100px 50px;
        gap: 8px;
        align-items: center;
    }

    .control-row h3 {
        grid-column: 1 / -1;
        margin: 0 0 5px 0;
        font-size: 13px;
        color: #888;
        text-transform: uppercase;
    }

    input[type="text"] {
        width: 100%;
        padding: 8px;
        font-size: 16px; /* ズーム防止 */
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }

    /* 16進数入力欄を英数入力しやすくする */
    .hex-input {
        font-family: monospace;
        text-transform: uppercase;
    }

    input[type="color"] {
        width: 100%;
        height: 38px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: none;
        cursor: pointer;
        padding: 0;
    }

    .download-btn {
        width: 100%;
        padding: 15px;
        font-size: 17px;
        font-weight: bold;
        color: white;
        background-color: #222;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin-bottom: 20px;
    }

    #capture-area {
        display: block;
        text-align: center;
    }

    .card {
        width: 450px;
        height: 160px;
        padding: 25px;
        border-radius: 25px;
        margin: 0 auto 20px auto;
        position: relative;
        box-sizing: border-box;
        text-align: left;
    }

    .label {
        position: absolute;
        bottom: 20px;
        left: 25px;
        font-weight: bold;
        font-size: 26px;
        line-height: 1.2em;
    }

    .code {
        font-size: 20px;
        opacity: 0.8;
        font-weight: normal;
    }
</style>
</head>

<body>

<button class="download-btn" onclick="downloadImage()">画像をダウンロード</button>

<div class="controls">
    <div class="control-row">
        <h3>Card 1</h3>
        <input id="label1" type="text" placeholder="名前">
        <input id="hex1" class="hex-input" type="text" value="#B9ECFF" maxlength="7">
        <input id="color1" type="color" value="#B9ECFF">
    </div>
    <div class="control-row">
        <h3>Card 2</h3>
        <input id="label2" type="text" placeholder="名前">
        <input id="hex2" class="hex-input" type="text" value="#A8D8FF" maxlength="7">
        <input id="color2" type="color" value="#A8D8FF">
    </div>
    <div class="control-row">
        <h3>Card 3</h3>
        <input id="label3" type="text" placeholder="名前">
        <input id="hex3" class="hex-input" type="text" value="#FFD0EC" maxlength="7">
        <input id="color3" type="color" value="#FFD0EC">
    </div>
    <div class="control-row">
        <h3>Card 4</h3>
        <input id="label4" type="text" placeholder="名前">
        <input id="hex4" class="hex-input" type="text" value="#FFFFFF" maxlength="7">
        <input id="color4" type="color" value="#FFFFFF">
    </div>
</div>

<div id="capture-area">
    <div id="card1" class="card"><div class="label"><span></span><br><span class="code"></span></div></div>
    <div id="card2" class="card"><div class="label"><span></span><br><span class="code"></span></div></div>
    <div id="card3" class="card"><div class="label"><span></span><br><span class="code"></span></div></div>
    <div id="card4" class="card"><div class="label"><span></span><br><span class="code"></span></div></div>
</div>

<script>
const COLOR_NAMES = [
    { name: "White", rgb: [255,255,255] }, { name: "Snow", rgb: [255,250,250] },
    { name: "Silver", rgb: [192,192,192] }, { name: "Gray", rgb: [128,128,128] },
    { name: "Charcoal", rgb: [54,69,79] }, { name: "Black", rgb: [0,0,0] },
    { name: "Mint Green", rgb: [189,252,201] }, { name: "Sky Blue", rgb: [135,206,235] },
    { name: "Navy", rgb: [0,0,128] }, { name: "Soft Pink", rgb: [255,192,203] },
    { name: "Hot Pink", rgb: [255,105,180] }, { name: "Red", rgb: [255,0,0] },
    { name: "Lemon Yellow", rgb: [255,250,205] }, { name: "Orange", rgb: [255,165,0] },
    { name: "Beige", rgb: [245,245,220] }, { name: "Lavender", rgb: [230,230,250] }
    // 必要に応じて元のリストをここに追加してください
];

function hexToRgb(hex) {
    if(!/^#([0-9A-F]{6})$/i.test(hex)) return [255,255,255];
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return [r, g, b];
}

function getClosestColorName(hex) {
    const [r, g, b] = hexToRgb(hex);
    let closest = "Custom Color";
    let minDistance = Infinity;
    COLOR_NAMES.forEach(c => {
        const distance = Math.pow(r - c.rgb[0], 2) + Math.pow(g - c.rgb[1], 2) + Math.pow(b - c.rgb[2], 2);
        if (distance < minDistance) {
            minDistance = distance;
            closest = c.name;
        }
    });
    return closest;
}

function syncAndUpdate(i, source) {
    const hexInp = document.getElementById(`hex${i}`);
    const colorInp = document.getElementById(`color${i}`);
    const labelInp = document.getElementById(`label${i}`);
    const card = document.getElementById(`card${i}`);
    const spans = card.querySelectorAll("span");

    let color = source === 'picker' ? colorInp.value : hexInp.value;

    // 16進数の形式チェック（テキスト入力時）
    if (source === 'hex' && !/^#[0-9A-Fa-f]{6}$/.test(color)) return;

    // 同期
    if (source === 'picker') hexInp.value = color.toUpperCase();
    if (source === 'hex') colorInp.value = color;

    // 自動命名（名前欄が未編集または空の場合のみ）
    if (!labelInp.dataset.manual || labelInp.value === "") {
        labelInp.value = getClosestColorName(color).toUpperCase();
    }

    // カード描画
    card.style.background = color;
    spans[0].textContent = labelInp.value;
    spans[1].textContent = color.toUpperCase();

    // 文字色反転
    const [r, g, b] = hexToRgb(color);
    const brightness = (r * 299 + g * 587 + b * 114) / 1000;
    card.style.color = brightness > 180 ? "#555" : "#fff";
}

// 全カードにイベント登録
for (let i = 1; i <= 4; i++) {
    const hexInp = document.getElementById(`hex${i}`);
    const colorInp = document.getElementById(`color${i}`);
    const labelInp = document.getElementById(`label${i}`);

    // 16進数入力時
    hexInp.addEventListener("input", () => syncAndUpdate(i, 'hex'));
    // カラーピッカー操作時
    colorInp.addEventListener("input", () => syncAndUpdate(i, 'picker'));
    // 名前入力時（手動フラグを立てる）
    labelInp.addEventListener("input", () => {
        labelInp.dataset.manual = "true";
        syncAndUpdate(i, 'hex');
    });
}

function downloadImage() {
    html2canvas(document.getElementById("capture-area"), { backgroundColor: null, scale: 2 }).then(canvas => {
        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = "color-cards.png";
        link.click();
    });
}

// 初期表示
for (let i = 1; i <= 4; i++) syncAndUpdate(i, 'hex');

</script>
</body>
</html>
