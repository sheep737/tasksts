<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Ultimate Color Card Gen</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
    :root {
        --bg-gray: #f2f2f7;
        --accent: #007aff;
    }
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background-color: var(--bg-gray);
        margin: 0;
        padding: 15px;
        padding-bottom: 100px;
    }

    /* ツールバー */
    .toolbar {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
    .btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        font-size: 15px;
        transition: opacity 0.2s;
    }
    .btn-main { background: var(--accent); color: white; }
    .btn-sub { background: #e5e5ea; color: #333; }
    .btn:active { opacity: 0.7; }

    /* 入力エリア */
    .input-grid {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .input-card {
        background: white;
        border-radius: 14px;
        padding: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        border-left: 8px solid transparent; /* ここに色が反映される */
    }
    .input-card input[type="text"] {
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 8px;
        font-size: 16px; /* ズーム防止 */
    }
    .name-input { flex: 2; }
    .hex-input { flex: 1; font-family: monospace; text-transform: uppercase; width: 80px; }
    .color-picker { width: 44px; height: 44px; border: none; background: none; padding: 0; cursor: pointer; }

    /* 出力エリア */
    #capture-area {
        margin-top: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .card {
        width: 450px;
        height: 160px;
        padding: 25px;
        border-radius: 25px;
        margin-bottom: 25px;
        position: relative;
        box-sizing: border-box;
        text-align: left;
    }
    .label {
        position: absolute;
        bottom: 20px;
        left: 25px;
        font-weight: bold;
        font-size: 26px;
        line-height: 1.2em;
    }
    .code { font-size: 20px; opacity: 0.8; font-weight: normal; }

    /* フッター固定 */
    .footer-actions {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(255,255,255,0.8);
        backdrop-filter: blur(10px);
        padding: 15px;
        display: flex;
        justify-content: center;
        border-top: 1px solid #ddd;
    }
</style>
</head>

<body>

<div class="toolbar">
    <button class="btn btn-sub" onclick="clearAll()">クリア</button>
    <button class="btn btn-sub" onclick="setSample()">サンプル</button>
</div>

<div class="input-grid" id="ui-root">
    </div>

<div id="capture-area">
    </div>

<div class="footer-actions">
    <button class="btn btn-main" style="max-width: 500px;" onclick="downloadImage()">画像として保存</button>
</div>

<script>
const COLOR_NAMES = [
    { name: "White", rgb: [255,255,255] }, { name: "Silver", rgb: [192,192,192] },
    { name: "Charcoal", rgb: [54,69,79] }, { name: "Black", rgb: [0,0,0] },
    { name: "Mint Green", rgb: [189,252,201] }, { name: "Sky Blue", rgb: [135,206,235] },
    { name: "Soft Pink", rgb: [255,192,203] }, { name: "Red", rgb: [255,0,0] },
    { name: "Lemon Yellow", rgb: [255,250,205] }, { name: "Beige", rgb: [245,245,220] }
];

// 初期データ
const data = [
    { label: "MINT GREEN", hex: "#B9ECFF" },
    { label: "SILVER", hex: "#A8D8FF" },
    { label: "PINK", hex: "#FFD0EC" },
    { label: "WHITE", hex: "#FFFFFF" }
];

function init() {
    const root = document.getElementById('ui-root');
    const area = document.getElementById('capture-area');
    root.innerHTML = '';
    area.innerHTML = '';

    for (let i = 0; i < 4; i++) {
        // 入力UI生成
        root.innerHTML += `
            <div class="input-card" id="row${i}">
                <input type="color" class="color-picker" id="p${i}">
                <input type="text" class="name-input" id="n${i}" placeholder="色名" value="${data[i].label}">
                <input type="text" class="hex-input" id="h${i}" placeholder="#HEX" value="${data[i].hex}" maxlength="7" inputmode="url">
            </div>
        `;
        // カード生成
        area.innerHTML += `
            <div id="card${i}" class="card">
                <div class="label"><span id="ln${i}"></span><br><span id="lh${i}" class="code"></span></div>
            </div>
        `;
    }

    // イベント紐付け
    for (let i = 0; i < 4; i++) {
        const p = document.getElementById(`p${i}`);
        const n = document.getElementById(`n${i}`);
        const h = document.getElementById(`h${i}`);

        p.addEventListener('input', () => { sync(i, 'p'); });
        h.addEventListener('input', () => { sync(i, 'h'); });
        n.addEventListener('input', () => { n.dataset.manual = "true"; sync(i, 'n'); });
        
        sync(i, 'init');
    }
}

function hexToRgb(hex) {
    if(!/^#([0-9A-F]{6})$/i.test(hex)) return [255,255,255];
    return [parseInt(hex.slice(1, 3), 16), parseInt(hex.slice(3, 5), 16), parseInt(hex.slice(5, 7), 16)];
}

function getClosestColorName(hex) {
    const [r, g, b] = hexToRgb(hex);
    let closest = "Color";
    let minDistance = Infinity;
    COLOR_NAMES.forEach(c => {
        const d = Math.pow(r-c.rgb[0],2) + Math.pow(g-c.rgb[1],2) + Math.pow(b-c.rgb[2],2);
        if (d < minDistance) { minDistance = d; closest = c.name; }
    });
    return closest;
}

function sync(i, source) {
    const p = document.getElementById(`p${i}`);
    const n = document.getElementById(`n${i}`);
    const h = document.getElementById(`h${i}`);
    const row = document.getElementById(`row${i}`);
    const card = document.getElementById(`card${i}`);
    const ln = document.getElementById(`ln${i}`);
    const lh = document.getElementById(`lh${i}`);

    let val = h.value;

    if (source === 'p') { val = p.value; h.value = val.toUpperCase(); }
    if (source === 'h') { if(/^#[0-9A-Fa-f]{6}$/.test(val)) p.value = val; }

    // 自動命名
    if (!n.dataset.manual || n.value === "") {
        n.value = getClosestColorName(p.value).toUpperCase();
    }

    // 反映
    row.style.borderLeftColor = p.value;
    card.style.backgroundColor = p.value;
    ln.innerText = n.value;
    lh.innerText = p.value.toUpperCase();

    // コントラスト
    const [r,g,b] = hexToRgb(p.value);
    const bright = (r*299 + g*587 + b*114) / 1000;
    card.style.color = bright > 180 ? "#555" : "#fff";
}

function clearAll() {
    for(let i=0; i<4; i++) {
        document.getElementById(`n${i}`).value = "";
        document.getElementById(`n${i}`).dataset.manual = "";
        document.getElementById(`h${i}`).value = "#FFFFFF";
        sync(i, 'h');
    }
}

function setSample() {
    const samples = [
        {l:"FOREST", h:"#2D5A27"}, {l:"SUNSET", h:"#FF8C42"},
        {l:"OCEAN", h:"#005F73"}, {l:"SAND", h:"#E9D8A6"}
    ];
    for(let i=0; i<4; i++) {
        document.getElementById(`n${i}`).value = samples[i].l;
        document.getElementById(`n${i}`).dataset.manual = "true";
        document.getElementById(`h${i}`).value = samples[i].h;
        sync(i, 'h');
    }
}

function downloadImage() {
    const btn = document.querySelector('.btn-main');
    btn.innerText = "生成中...";
    html2canvas(document.getElementById("capture-area"), { backgroundColor: null, scale: 2 }).then(canvas => {
        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = `Palette_${Date.now()}.png`;
        link.click();
        btn.innerText = "画像として保存";
    });
}

init();
</script>
</body>
</html>
